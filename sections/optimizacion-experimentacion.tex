\section{Optimización y experimentación}
En la siguiente sección, se evaluará el rendimiento de la base de datos mediante la ejecución de tres consultas complejas. Este análisis se llevará a cabo en varios escenarios que incluyen diferentes volúmenes de datos, y se realizarán pruebas sin índices, únicamente con los índices por defecto y con los índices que consideremos más adecuados para garantizar la ejecución óptima de estas consultas. Finalmente, se procederá a analizar y comparar los resultados obtenidos.
\subsection{Consultas SQL para el experimento}
\subsubsection{Descripción del tipo de consultas seleccionadas} % TODO: Revisar todas las descripciones y justificación.
\begin{itemize}
    \item{\textbf{Consulta 1}: La siguiente consulta obtiene el nombre, email y número de celular de los directores actuales, así como la dirección, coordenadas y fecha de construcción de las 20 sedes más antiguas construidas entre 1990 y 2010, excluyendo aquellas sedes donde el número total de profesores y alumnos exceda 400.}
          \begin{itemize}
              \item{\textbf{Justificación}: La institución educativa está en un proceso de planificación para realizar renovaciones y mantenimiento en sus sedes. Se ha decidido comenzar con las sedes construidas entre los años 1990 y 2010, ya que estas son las que han demostrado tener más necesidad de atención. Para minimizar las interrupciones en las actividades escolares, se ha establecido que solo se seleccionarán aquellas sedes donde la suma del número de profesores y alumnos no exceda 400. Además, se requiere la información de los directores de estas sedes para coordinar las visitas de evaluación y supervisión.}
          \end{itemize}
    \item{\textbf{Consulta 2}: Se desea conocer el nombre completo, bonificación, código de cuenta interbancaria e email de los colaboradores identificados como activos actualmente a los que les corresponde el bono que ofrece la institución. Para calcular la bonificación debemos tomar en cuenta que las sedes que este año están cumpliendo un aniversario múltiplo de 10 (sin contar al 0) ofrecen un bono de 5\% respecto al pago mensual (el sueldo mensual se obtiene cuadruplicando la multiplicación del pago por hora por las horas semanales) para sus colaboradores que nacieron entre 1960 y 1980.}
          \begin{itemize}
              \item{\textbf{Justificación}: La institución tiene una política que consiste en que cada 10 años desde la construcción de cada sede se ofrece un bono de 5\% respecto al pago mensual, a los colaboradores activos mayores que trabajan en esa sede. Para obtener el monto de bonificación se debe cuadruplicar la multiplicación de la remuneración establecida por hora por la cantidad de horas semanales laboradas. De existir un colaborador que labore en más de una sede se debe evaluar la condición del aniversario para todas las sedes; si se cumple la condición en más de una, debemos multiplicar el bono por el número de sedes en las que se cumpla. El área de finanzas debe realizar el desembolso de este bono; por ello, se necesita conocer el nombre completo, monto respectivo, código de cuenta interbancaria para realizar la transferencia de este, y su email para enviar el comprobante de pago. }
          \end{itemize}
    \item{\textbf{Consulta 3}: Se desea conocer el nombre, primer apellido, segundo apellido, sexo e email de los alumnos menores de 18 años cuyo apoderado sea un colaborador registrado como activo, que trabaja a tiempo completo (más de 48 horas semanales) y cuyo sueldo mensual sea menor a 2000 soles (el sueldo mensual se obtiene cuadruplicando la multiplicación del pago por hora por las horas semanales). Además deben haber transcurrido como mínimo 2 años desde la matrícula del alumno.}
          \begin{itemize}
              \item{\textbf{Justificacion}: La institución educativa va a implementar la iniciativa de ofrecer un descuento especial en el pago mensual a los alumnos menores de 18 años cuyo apoderado sea un colaborador de la institución, siempre y cuando esté registrado como activo, labore a tiempo completo, su sueldo mensual (resultado de cuadruplicar la multiplicación de sueldo por hora, por las horas semanales) sea menor a 2000. El alumno debe haber estado matriculado por lo menos 2 años antes del actual.}
          \end{itemize}
\end{itemize}
\subsubsection{Implementación de consultas en SQL}
\begin{itemize}
    \item{\textbf{Consulta 1}:
          \lstinputlisting[language=SQL]{code-snippets/query-1/query_1.sql.}}
    \item{\textbf{Consulta 2}:
          \lstinputlisting[language=SQL]{code-snippets/query-2/query_2.sql}}
    \item{\textbf{Consulta 3}:
          \lstinputlisting[language=SQL]{code-snippets/query-3/query_3.sql}}
\end{itemize}
\subsection{Metodología del experimento}
\begin{sloppypar}
    Primero, creamos cuatro esquemas: ``mil\_datos'', ``diezmil\_datos'', ``cienmil\_datos'' y ``millon\_datos''. Cada uno de estos esquemas contiene la cantidad de datos que su nombre indica.
\end{sloppypar}
\lstinputlisting[language=SQL]{code-snippets/create_schemas.sql}
Luego, ejecutaremos cada consulta en cada uno de los esquemas, primero, sin índices, segundo, con los índices por defecto y, finalmente, con los índices por defecto más los índices que consideremos más adecuados para garantizar la ejecución óptima de estas consultas.\\
Finalmente, mediremos el tiempo de ejecución y analizaremos los planes de ejercución de cada consulta en cada uno de los escenarios mencionados.
\subsection{Optimización de consultas}
\subsubsection{Planes de índices para la primera consulta}
\begin{itemize}
    \item{Ejecución sin índices}
          \queryExecutionPlanGroup{code-snippets/query-2/query_2_unindexed.sql}{figures/query-2/query_2_unindexed_mil_datos.png}{figures/query-2/query_2_unindexed_diezmil_datos.png}{figures/query-2/query_2_unindexed_cienmil_datos.png}{figures/query-2/query_2_unindexed_cienmil_datos.png}
    \item{Ejercución con índices por defecto}
          \queryExecutionPlanGroup{code-snippets/query-2/query_2_indexed_default.sql}{figures/query-2/query_2_indexed_default_mil_datos.png}{figures/query-2/query_2_indexed_default_diezmil_datos.png}{figures/query-2/query_2_indexed_default_cienmil_datos.png}{figures/query-2/query_2_indexed_default_millon_datos.png}
    \item{Ejecución con índices por defecto más índices personalizados}
          \queryExecutionPlanGroup{code-snippets/query-2/query_2_unindexed.sql}{figures/query-2/query_2_unindexed_mil_datos.png}{figures/query-2/query_2_unindexed_diezmil_datos.png}{figures/query-2/query_2_unindexed_cienmil_datos.png}{figures/query-2/query_2_unindexed_cienmil_datos.png}
\end{itemize}
\subsubsection{Planes de índices para la segunda consulta}
\begin{itemize}
    \item{Ejecución sin índices}
          \queryExecutionPlanGroup{code-snippets/query-2/query_2_unindexed.sql}{figures/query-2/query_2_unindexed_mil_datos.png}{figures/query-2/query_2_unindexed_diezmil_datos.png}{figures/query-2/query_2_unindexed_cienmil_datos.png}{figures/query-2/query_2_unindexed_cienmil_datos.png}
    \item{Ejercución con índices por defecto}
          \queryExecutionPlanGroup{code-snippets/query-2/query_2_indexed_default.sql}{figures/query-2/query_2_indexed_default_mil_datos.png}{figures/query-2/query_2_indexed_default_diezmil_datos.png}{figures/query-2/query_2_indexed_default_cienmil_datos.png}{figures/query-2/query_2_indexed_default_millon_datos.png}
    \item{Ejecución con índices por defecto más índices personalizados}
          \queryExecutionPlanGroup{code-snippets/query-2/query_2_unindexed.sql}{figures/query-2/query_2_unindexed_mil_datos.png}{figures/query-2/query_2_unindexed_diezmil_datos.png}{figures/query-2/query_2_unindexed_cienmil_datos.png}{figures/query-2/query_2_unindexed_cienmil_datos.png}
\end{itemize}
\subsubsection{Planes de índices para la tercera consulta}
\begin{itemize}
    \item{Ejecución sin índices}
          \queryExecutionPlanGroup{code-snippets/query-2/query_2_unindexed.sql}{figures/query-2/query_2_unindexed_mil_datos.png}{figures/query-2/query_2_unindexed_diezmil_datos.png}{figures/query-2/query_2_unindexed_cienmil_datos.png}{figures/query-2/query_2_unindexed_cienmil_datos.png}
    \item{Ejercución con índices por defecto}
          \queryExecutionPlanGroup{code-snippets/query-2/query_2_indexed_default.sql}{figures/query-2/query_2_indexed_default_mil_datos.png}{figures/query-2/query_2_indexed_default_diezmil_datos.png}{figures/query-2/query_2_indexed_default_cienmil_datos.png}{figures/query-2/query_2_indexed_default_millon_datos.png}
    \item{Ejecución con índices por defecto más índices personalizados}
          \queryExecutionPlanGroup{code-snippets/query-2/query_2_unindexed.sql}{figures/query-2/query_2_unindexed_mil_datos.png}{figures/query-2/query_2_unindexed_diezmil_datos.png}{figures/query-2/query_2_unindexed_cienmil_datos.png}{figures/query-2/query_2_unindexed_cienmil_datos.png}
\end{itemize}
\subsection{Plataforma de pruebas}
\begin{table}[H]
    \centering
    \begin{tabular}{|>{\raggedright\arraybackslash}m{4cm}|>{\raggedright\arraybackslash}m{6cm}|}
        \hline
        \textbf{Sistema Operativo} & Windows 10 64-bits   \\ \hline
        \textbf{RAM}               & 16 GB                \\ \hline
        \textbf{CPU}               & Intel Core i7-10750H \\ \hline
        \textbf{Capacidad SSD}     & 512 GB               \\ \hline
        \textbf{Capacidad HDD}     & 1 TB                 \\ \hline
        \textbf{PostgreSQL}        & 16.0                 \\ \hline
    \end{tabular}
    \caption{Especificaciones plataforma de pruebas}
\end{table}
\subsection{Medición de tiempos}
\subsubsection{Sin índices}
\subsubsection{Con índices}
\subsection{Resultados}
\subsubsection{Consulta 1}
\subsubsection{Consulta 2}
\subsubsection{Consulta 3}
\section{Análisis y discusión}